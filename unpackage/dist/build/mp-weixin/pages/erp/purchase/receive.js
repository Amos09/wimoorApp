"use strict";var t=require("../../../common/vendor.js"),e=require("../../../api/erp/purchase/purchase.js");require("../../../common/request.js");const a={data:()=>({title:"",data:{},htmlNodes:[],entry:{},needamount:0,placeholderStyle:"color:#ffa400;font-size:14px",styles:{color:"#ffa400",borderColor:"#ffa400"},reclist:[],orderData:[],LogResult:[],traceResult:[],deliveredTime:0,iptamount:0,ipt:!1}),onLoad(t){const e=t.detailDate||t.payload;try{this.data=JSON.parse(decodeURIComponent(e))}catch(a){this.data=JSON.parse(e)}this.loadRecDetail()},methods:{formatDate(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));let a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(let i in a)if(new RegExp(`(${i})`).test(e)){let t=a[i]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?t:this.padLeftZero(t))}return e},padLeftZero:t=>("00"+t).substr(t.length),loadRecDetail(){this.data.entryid&&e.purchaseApi.getRecdetail({id:this.data.entryid,ftype:"rec"}).then((t=>{t&&t.entry&&(this.entry=t.entry,this.needamount=t.entry.amount-t.entry.totalin,this.reclist=t.receivelist,this.iptamount=this.needamount,null!=this.data.alibaba_orderid&&null!=this.data.alibaba_orderid&&""!=this.data.alibaba_orderid&&"undefined"!=this.data.alibaba_orderid&&this.loadEntryLogist())}))},numberFuc:t=>null==t||null==t||""==t?"--":t,amountFunc(t,e,a){return t-e<=0||1==a?"待收货物数:0":"待收货物数:"+this.needamount},input(t){this.iptamount=parseInt(t)},loadEntryLogist(){e.purchaseApi.catchLogisticsInfo({alibabaAuthid:this.data.alibaba_auth,alibabaOrderid:this.data.alibaba_orderid,purchaseEntryid:this.data.entryid}).then((t=>{let e=JSON.parse(t.orderResult),a=JSON.parse(t.LogisticsResult),i=JSON.parse(t.TraceResult),s=0;null!=e&&""!=e&&"undefined"!=e&&"undefined"!=e&&(null!=e.result.nativeLogistics.logisticsItems&&e.result.nativeLogistics.logisticsItems.length>0&&(s=e.result.nativeLogistics.logisticsItems[0].deliveredTime),this.orderData=e.result,this.LogResult=a.result,this.traceResult=i.logisticsTrace,this.deliveredTime=s)}))},dateFuc(t){if(null!=t&&null!=t&&""!=t&&t>0){let e=new Date(t);return this.formatDate(e,"yyyy-MM-dd hh:mm:ss")}return"--"},bindsubmitTap(){this.iptamount>0?e.purchaseApi.rec({status:"0",entryid:this.data.entryid,amount:this.iptamount,warehouse:this.data.warehouseid,ftype:"in",recid:""}).then((e=>{this.ipt=!0,t.index.showToast({title:"操作成功！",icon:"none",duration:2e3}),this.loadRecDetail()})):t.index.showToast({title:"请输入正确的数量！",icon:"none",duration:2e3})}}};if(!Array){t.resolveComponent("uni-easyinput")()}Math;var i=t._export_sfc(a,[["render",function(e,a,i,s,l,n){return t.e({a:t.t(l.data.sku),b:t.t(l.data.warehousename),c:t.t(n.amountFunc(l.entry.amount,l.entry.totalin,l.entry.inwhstatus)),d:t.t(n.numberFuc(l.entry.totalin)),e:t.t(n.numberFuc(l.entry.totalre)),f:1!=l.entry.inwhstatus},1!=l.entry.inwhstatus?{g:t.o(n.input),h:t.o((t=>l.iptamount=t)),i:t.p({type:"number",disabled:l.ipt,styles:l.styles,placeholderStyle:l.placeholderStyle,placeholder:"请输入操作的数量",modelValue:l.iptamount}),j:l.ipt,k:t.o(((...t)=>n.bindsubmitTap&&n.bindsubmitTap(...t)))}:{},{l:null!=l.reclist&&l.reclist.length>0&&null!=l.reclist},null!=l.reclist&&l.reclist.length>0&&null!=l.reclist?{m:t.f(l.reclist,((e,a,i)=>t.e({a:t.t(e.operator),b:"in"==e.ftype},(e.ftype,{}),{c:"out"==e.ftype},(e.ftype,{}),{d:"clear"==e.ftype},(e.ftype,{}),{e:t.t(e.warehousename),f:"in"==e.ftype},"in"==e.ftype?{g:t.t(e.amount)}:{},{h:"out"==e.ftype},"out"==e.ftype?{i:t.t(e.amount)}:{},{j:"clear"==e.ftype},"clear"==e.ftype?{k:t.t(e.amount)}:{},{l:t.t(n.dateFuc(e.opttime)),m:t.t(e.remark),n:a})))}:{},{n:"undefined"!=l.data.alibaba_orderid&&""!=l.data.alibaba_orderid&&null!=l.data.alibaba_orderid&&null!=l.data.alibaba_orderid},"undefined"!=l.data.alibaba_orderid&&""!=l.data.alibaba_orderid&&null!=l.data.alibaba_orderid&&null!=l.data.alibaba_orderid?t.e({o:null!=l.LogResult&&""!=l.LogResult&&"undefined"!=l.LogResult&&"undefined"!=l.LogResult&&l.LogResult.length>0},null!=l.LogResult&&""!=l.LogResult&&"undefined"!=l.LogResult&&"undefined"!=l.LogResult&&l.LogResult.length>0?{p:t.f(l.LogResult,((e,a,i)=>t.e({a:t.t(e.logisticsId),b:t.t(e.logisticsCompanyName),c:t.t(e.logisticsBillNo)},null!=l.traceResult&&l.traceResult.length>0?{d:t.f(l.traceResult,((a,i,s)=>t.e({a:e.logisticsId==a.logisticsId&&null!=a.logisticsSteps&&a.logisticsSteps.length>0},e.logisticsId==a.logisticsId&&null!=a.logisticsSteps&&a.logisticsSteps.length>0?{b:t.f(a.logisticsSteps,((e,a,i)=>({a:t.t(n.dateFuc(e.acceptTime?e.acceptTime:"")),b:t.t(e.remark),c:a})))}:{},{c:i})))}:{},{e:t.t(e.logisticsCompanyName),f:null!=e.sendGoods&&e.sendGoods.length>0},null!=e.sendGoods&&e.sendGoods.length>0?{g:t.f(e.sendGoods,((e,a,i)=>({a:t.f(l.orderData.productItems,((a,i,s)=>t.e({a:a.name==e.goodName},a.name==e.goodName?{b:a.productImgUrl[0],c:t.t(e.goodName),d:t.t(e.quantity),e:t.t(e.unit)}:{},{f:i}))),b:a})))}:{},{h:a}))),q:t.t(n.dateFuc(l.deliveredTime)),r:null!=l.traceResult&&l.traceResult.length>0}:{}):{})}]]);wx.createPage(i);
