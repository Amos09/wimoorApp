"use strict";const e=require("../../../../../common/vendor.js"),t=require("../../../../../api/erp/ship/quotaApi.js");require("../../../../../utils/request.js"),require("../../../../../store/index.js");const i={props:["item","itemid","isAssemblyItem","warehouseid"],components:{},data:()=>({current:-1,offShelfNum:-1,shelfListData:[],shipmentid:"",createdate:"-",auditime:"-",shelfid:"",active:2,warehouseList:[{title:"暂无数据",desc:"发货仓库"},{title:"暂无数据",desc:"目的仓库"}],productListData:[],quotaoderData:{},sumin:0}),onLoad(e){this.offShelfNum=-1},methods:{getChecked(e,t){return-1==this.current&&(t.forEach(((e,t)=>{e.quantity>0&&(this.current=t,this.shelfid=e.shelfid)})),-1==this.current&&(this.current=0,this.shelfid=t[0].shelfid)),this.current==e},goMaterialInfoPage(t){1==this.$props.isAssemblyItem?e.index.navigateTo({url:"../../material/material?materialid="+t.mainmid}):e.index.navigateTo({url:"../../material/material?materialid="+t.materialid})},needshow(e){if(e&&e.length>0)for(let t=0;t<e.length;t++)if(e[t]&&e[t].quantity>0)return!0;return!1},getoffShelfNum(e,t,i){let s=0,a=e;if(this.$props.item.shelfInvRecordList){var m=0;this.$props.item.shelfInvRecordList.forEach((e=>{0==e.opt?m+=parseInt(e.quantity):m-=+parseInt(e.quantity)})),this.sumin=m,m&&(a-=m)}return t.forEach(((e,t)=>{this.current==t&&(s=a<=parseInt(e.quantity)?a:parseInt(e.quantity))})),-1!=this.offShelfNum&&"change"!=i||(this.offShelfNum=s),s},goHuoJia(t){var i={materialid:t,warehouseid:""};i.warehouseid=this.$props.warehouseid,i.formid=this.$props.itemid,i.formtype="outstockform",i.opttype="outstockform";let s=this.$props.item;var a=0;(a=1==this.$props.isAssemblyItem?this.getoffShelfNum(s.subamount,this.$props.item.shelfInvList,"change"):this.getoffShelfNum(s.quantity,this.$props.item.shelfInvList,"change"))<0&&(i.amount=-1*a);var m=encodeURIComponent(JSON.stringify(i));e.index.navigateTo({url:"/pages/erp/warehouse/shelf/index?detailData="+m})},getshelfid:(e,t)=>e,maxShelfNum(e){let t=0;return e.forEach(((e,i)=>{this.current==i&&(t=e.quantity?parseInt(e.quantity):0)})),t},subShelfNum(i){let s=[],a={},m=i[this.current];a.materialid=m.materialid,a.shelfid=m.shelfid,a.formid=this.$props.itemid,a.formtype="outstockform",a.quantity=this.offShelfNum,a.opt=0,s.push(a);let n=this;t.quotaApi.subShelfInventory(s).then((t=>{e.index.showToast({title:"下架成功！",icon:"none",duration:2e3});let s=i[n.current];s.quantity=s.quantity-n.offShelfNum;var a={opttime:"",shelfname:"",quantity:""};a.opttime=(new Date).format("yyyy-MM-dd hh:mm:ss"),a.shelfname=s.shelfname,a.quantity=n.offShelfNum,a.opt=0,n.$props.item.shelfInvRecordList?n.$props.item.shelfInvRecordList.push(a):n.$props.item.shelfInvRecordList=[a]}))},offshelfValChange(e){this.offShelfNum=e.detail.value},radioChange(e){this.current=e.detail.value;let t=this.$props.item.shelfInvList[this.current];this.getoffShelfNum(t.quantity,this.$props.item.shelfInvList,"change")}}};if(!Array){(e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table"))()}Math||((()=>"../../../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../../../uni_modules/uni-table/components/uni-table/uni-table.js"))();const s=e._export_sfc(i,[["render",function(t,i,s,a,m,n){return e.e({a:s.item.image},s.item.image?{b:e.o((e=>n.goMaterialInfoPage(s.item))),c:s.item.image}:{d:e.o((e=>n.goMaterialInfoPage(s.item)))},{e:0==s.isAssemblyItem},0==s.isAssemblyItem?{f:e.t(s.item.name)}:{g:e.t(s.item.mname)},{h:0==s.isAssemblyItem},0==s.isAssemblyItem?{i:e.t(s.item.sku),j:e.o((e=>n.goHuoJia(s.item.materialid)))}:{k:e.t(s.item.sku),l:e.o((e=>n.goHuoJia(s.item.submid)))},{m:0==s.isAssemblyItem},0==s.isAssemblyItem?{n:e.t(s.item.sellersku)}:{},{o:0==s.isAssemblyItem},0==s.isAssemblyItem?{p:e.t(s.item.fnsku)}:{},{q:e.t(s.item.boxnum),r:s.item.boxlength},s.item.boxlength?{s:e.t(s.item.boxlength),t:e.t(s.item.boxwidth),v:e.t(s.item.boxheight)}:{},{w:s.item.boxweight},s.item.boxweight?{x:e.t(s.item.boxweight)}:{},{y:n.needshow(s.item.shelfInvList)},n.needshow(s.item.shelfInvList)?{z:e.p({align:"left",width:"10"}),A:e.p({align:"left",width:"190"}),B:e.p({align:"left",width:"50"}),C:e.f(s.item.shelfInvList,((t,i,a)=>({a:i,b:n.getChecked(i,s.item.shelfInvList),c:"6f0f3faa-6-"+a+",6f0f3faa-5-"+a,d:e.t(t.shelfname),e:"6f0f3faa-7-"+a+",6f0f3faa-5-"+a,f:e.t(t.quantity),g:"6f0f3faa-8-"+a+",6f0f3faa-5-"+a,h:i,i:"6f0f3faa-5-"+a+",6f0f3faa-0"}))),D:e.p({border:!0,emptyText:"暂无数据"}),E:e.o(((...e)=>n.radioChange&&n.radioChange(...e)))}:{},{F:0==s.isAssemblyItem},0==s.isAssemblyItem?{G:e.t(s.item.quantity)}:{},{H:0==s.isAssemblyItem},(s.isAssemblyItem,{}),{I:1==s.isAssemblyItem},1==s.isAssemblyItem?{J:e.t(s.item.subamount)}:{},{K:1==s.isAssemblyItem},(s.isAssemblyItem,{}),{L:0==s.isAssemblyItem},0==s.isAssemblyItem?{M:e.t(s.item.invquantity)}:{N:e.t(s.item.fulfillable)},{O:n.needshow(s.item.shelfInvList)},n.needshow(s.item.shelfInvList)?e.e({P:0==s.isAssemblyItem},0==s.isAssemblyItem?{Q:e.o(((...e)=>n.offshelfValChange&&n.offshelfValChange(...e))),R:n.getoffShelfNum(s.item.quantity,s.item.shelfInvList)}:{S:e.o(((...e)=>n.offshelfValChange&&n.offshelfValChange(...e))),T:n.getoffShelfNum(s.item.subamount,s.item.shelfInvList)},{U:e.o((()=>n.subShelfNum(s.item.shelfInvList)))}):{},{V:s.item.shelfInvRecordList},s.item.shelfInvRecordList?{W:e.t(m.sumin),X:e.p({align:"left",width:"150"}),Y:e.p({align:"left",width:"100"}),Z:e.f(s.item.shelfInvRecordList,((t,i,s)=>e.e({a:e.t(t.shelfname),b:e.t(t.opttime),c:"6f0f3faa-14-"+s+",6f0f3faa-13-"+s,d:0==t.opt},(t.opt,{}),{e:e.t(t.quantity),f:"6f0f3faa-15-"+s+",6f0f3faa-13-"+s,g:i,h:"6f0f3faa-13-"+s+",6f0f3faa-9"}))),aa:e.p({border:!0,emptyText:"暂无操作记录"})}:{})}]]);wx.createComponent(s);
