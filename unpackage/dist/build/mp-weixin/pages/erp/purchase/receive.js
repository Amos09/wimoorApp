"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/erp/purchase/purchase.js");require("../../../utils/request.js"),require("../../../store/index.js");const a={components:{WarehousePick:()=>"./components/warehousepick.js"},data:()=>({title:"",data:{},htmlNodes:[],entry:{},needamount:0,placeholderStyle:"color:#ffa400;font-size:14px",styles:{color:"#ffa400",borderColor:"#ffa400"},reclist:[],orderData:[],LogResult:[],traceResult:[],deliveredTime:0,iptamount:0,ipt:!1,warehouseid:""}),onLoad(e){const t=e.detailData||e.payload;try{this.data=JSON.parse(decodeURIComponent(t))}catch(a){this.data=JSON.parse(t)}this.data&&(this.warehouseid=this.data.warehouseid),this.loadRecDetail()},methods:{formatDate(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));let a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(let i in a)if(new RegExp(`(${i})`).test(t)){let e=a[i]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?e:this.padLeftZero(e))}return t},suppliernameFuc:e=>null==e||null==e||""==e?"--":e,paystatusFuc:e=>"1"==e||1==e?"已付款":"未付款",deliverydateFuc:e=>null!=e&&null!=e&&""!=e?e.split(" ")[0]:"--",statusFuc:e=>0==e||"0"==e?"已退回":1==e||"1"==e?"待审核":2==e||"2"==e?"执行中":3==e||"3"==e?"已完成":void 0,dialogToggle(){this.$refs.alertDialog.open()},padLeftZero:e=>("00"+e).substr(e.length),warehouseChange(e){this.warehouseid=e},loadRecDetail(){this.data.id&&t.purchaseApi.getRecdetail({id:this.data.id,ftype:"rec"}).then((e=>{e&&e.entry&&(this.entry=e.entry,this.needamount=e.entry.amount-e.entry.totalin,this.reclist=e.receivelist,this.reclist&&this.reclist.forEach((e=>{e.sumin=0,e.shelfInvRecordList&&e.shelfInvRecordList.forEach((t=>{1==t.opt?e.sumin=e.sumin+t.quantity:e.sumin=e.sumin-t.quantity}))})),this.iptamount=this.needamount,null!=this.data.alibaba_orderid&&null!=this.data.alibaba_orderid&&""!=this.data.alibaba_orderid&&"undefined"!=this.data.alibaba_orderid&&this.loadEntryLogist())}))},numberFuc:e=>null==e||null==e||""==e?"--":e,amountFunc(e,t,a){return e-t<=0||1==a?"待收货:0":"待收货:"+this.needamount},input(e){this.iptamount=parseInt(e)},loadEntryLogist(){t.purchaseApi.catchLogisticsInfo({alibabaAuthid:this.data.alibaba_auth,alibabaOrderid:this.data.alibaba_orderid,purchaseEntryid:this.data.entryid}).then((e=>{let t=JSON.parse(e.orderResult),a=JSON.parse(e.LogisticsResult),i=JSON.parse(e.TraceResult),s=0;null!=t&&""!=t&&"undefined"!=t&&"undefined"!=t&&(null!=t.result.nativeLogistics.logisticsItems&&t.result.nativeLogistics.logisticsItems.length>0&&(s=t.result.nativeLogistics.logisticsItems[0].deliveredTime),this.orderData=t.result,this.LogResult=a.result,this.traceResult=i.logisticsTrace,this.deliveredTime=s)}))},dateFuc(e){if(null!=e&&null!=e&&""!=e&&e>0){let t=new Date(e);return this.formatDate(t,"yyyy-MM-dd hh:mm:ss")}return"--"},bindsubmitTap(){if(this.iptamount>0){var a="0";this.needamount<=this.iptamount&&(a="1"),t.purchaseApi.rec({status:a,entryid:this.data.id,amount:this.iptamount,warehouse:this.warehouseid,ftype:"in",recid:""}).then((t=>{this.ipt=!0,e.index.showToast({title:"操作成功！",icon:"none",duration:2e3}),this.loadRecDetail()}))}else e.index.showToast({title:"请输入正确的数量！",icon:"none",duration:2e3})},clearRec(){var a=this.data.id;t.purchaseApi.clearRec({entryid:a}).then((t=>{e.index.showToast({title:"操作成功！",icon:"none",duration:2e3}),this.ipt=!1,this.loadRecDetail()}))},goHuoJia(t,a){t.materialid=a.materialid,t.opttype="purchase",e.index.navigateTo({url:"/pages/erp/warehouse/shelf/index?detailData="+encodeURIComponent(JSON.stringify(t))})}}};if(!Array){(e.resolveComponent("uni-card")+e.resolveComponent("WarehousePick")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table"))()}Math||((()=>"../../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../uni_modules/uni-table/components/uni-table/uni-table.js"))();const i=e._export_sfc(a,[["render",function(t,a,i,s,n,o){return e.e({a:e.t(n.data.amount),b:e.t(n.data.warehousename),c:e.t(o.deliverydateFuc(n.data.deliverydate)),d:e.t(o.paystatusFuc(n.data.paystatus)),e:e.t(n.data.number),f:e.t(n.data.creatorname),g:e.t(n.data.createdate),h:e.p({title:n.data.sku,"sub-title":o.suppliernameFuc(n.data.suppliername),extra:o.statusFuc(n.data.auditstatus),thumbnail:n.data.image}),i:e.o(o.warehouseChange),j:e.p({warehouseid:n.data.warehouseid}),k:e.t(o.amountFunc(n.entry.amount,n.entry.totalin,n.entry.inwhstatus)),l:e.t(o.numberFuc(n.entry.totalin)),m:e.t(o.numberFuc(n.entry.totalre)),n:1!=n.entry.inwhstatus},1!=n.entry.inwhstatus?{o:e.o(o.input),p:e.o((e=>n.iptamount=e)),q:e.p({type:"number",disabled:n.ipt,styles:n.styles,placeholderStyle:n.placeholderStyle,placeholder:"请输入操作的数量",modelValue:n.iptamount}),r:n.ipt,s:e.o(((...e)=>o.bindsubmitTap&&o.bindsubmitTap(...e)))}:{},{t:e.o(o.clearRec),v:e.o(t.dialogClose),w:e.p({type:"warn",cancelText:"关闭",confirmText:"同意",title:"通知",content:"您确定要撤销所有入库吗？"}),x:e.sr("alertDialog","ec5cc86a-5,ec5cc86a-4"),y:e.p({type:"dialog"}),z:e.o(((...e)=>o.dialogToggle&&o.dialogToggle(...e))),A:null!=n.reclist&&n.reclist.length>0&&null!=n.reclist},null!=n.reclist&&n.reclist.length>0&&null!=n.reclist?{B:e.f(n.reclist,((t,a,i)=>e.e({a:e.t(t.operator),b:"in"==t.ftype},(t.ftype,{}),{c:"out"==t.ftype},(t.ftype,{}),{d:"clear"==t.ftype},(t.ftype,{}),{e:"in"==t.ftype},"in"==t.ftype?{f:e.o((e=>o.goHuoJia(t,n.data)))}:{},{g:"in"==t.ftype},"in"==t.ftype?{h:e.t(t.amount)}:{},{i:"out"==t.ftype},"out"==t.ftype?{j:e.t(t.amount)}:{},{k:"clear"==t.ftype},"clear"==t.ftype?{l:e.t(t.amount)}:{},{m:e.t(t.warehousename),n:e.t(o.dateFuc(t.opttime)),o:e.t(t.remark),p:t.shelfInvRecordList&&t.shelfInvRecordList.length>0},t.shelfInvRecordList&&t.shelfInvRecordList.length>0?{q:e.t(t.sumin),r:"ec5cc86a-9-"+i+",ec5cc86a-8-"+i,s:e.p({align:"left",width:"150"}),t:"ec5cc86a-10-"+i+",ec5cc86a-8-"+i,v:e.p({align:"left",width:"100"}),w:"ec5cc86a-8-"+i+",ec5cc86a-7-"+i,x:e.f(t.shelfInvRecordList,((t,a,s)=>e.e({a:e.t(t.shelfname),b:e.t(t.opttime),c:"ec5cc86a-12-"+i+"-"+s+",ec5cc86a-11-"+i+"-"+s,d:0==t.opt},(0==t.opt||t.opt,{}),{e:1==t.opt,f:e.t(t.quantity),g:"ec5cc86a-13-"+i+"-"+s+",ec5cc86a-11-"+i+"-"+s,h:a,i:"ec5cc86a-11-"+i+"-"+s+",ec5cc86a-7-"+i}))),y:"ec5cc86a-7-"+i+",ec5cc86a-4",z:e.p({border:!0,emptyText:"暂无操作记录"})}:{},{A:a})))}:{},{C:"undefined"!=n.data.alibaba_orderid&&""!=n.data.alibaba_orderid&&null!=n.data.alibaba_orderid&&null!=n.data.alibaba_orderid},"undefined"!=n.data.alibaba_orderid&&""!=n.data.alibaba_orderid&&null!=n.data.alibaba_orderid&&null!=n.data.alibaba_orderid?e.e({D:null!=n.LogResult&&""!=n.LogResult&&"undefined"!=n.LogResult&&"undefined"!=n.LogResult&&n.LogResult.length>0},null!=n.LogResult&&""!=n.LogResult&&"undefined"!=n.LogResult&&"undefined"!=n.LogResult&&n.LogResult.length>0?{E:e.f(n.LogResult,((t,a,i)=>e.e({a:e.t(t.logisticsId),b:e.t(t.logisticsCompanyName),c:e.t(t.logisticsBillNo)},null!=n.traceResult&&n.traceResult.length>0?{d:e.f(n.traceResult,((a,i,s)=>e.e({a:t.logisticsId==a.logisticsId&&null!=a.logisticsSteps&&a.logisticsSteps.length>0},t.logisticsId==a.logisticsId&&null!=a.logisticsSteps&&a.logisticsSteps.length>0?{b:e.f(a.logisticsSteps,((t,a,i)=>({a:e.t(o.dateFuc(t.acceptTime?t.acceptTime:"")),b:e.t(t.remark),c:a})))}:{},{c:i})))}:{},{e:e.t(t.logisticsCompanyName),f:null!=t.sendGoods&&t.sendGoods.length>0},null!=t.sendGoods&&t.sendGoods.length>0?{g:e.f(t.sendGoods,((t,a,i)=>({a:e.f(n.orderData.productItems,((a,i,s)=>e.e({a:a.name==t.goodName},a.name==t.goodName?{b:a.productImgUrl[0],c:e.t(t.goodName),d:e.t(t.quantity),e:e.t(t.unit)}:{},{f:i}))),b:a})))}:{},{h:a}))),F:e.t(o.dateFuc(n.deliveredTime)),G:null!=n.traceResult&&n.traceResult.length>0}:{}):{},{H:e.p({title:"物流记录"})})}]]);wx.createPage(i);
