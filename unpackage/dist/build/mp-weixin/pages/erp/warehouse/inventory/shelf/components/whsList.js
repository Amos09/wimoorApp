"use strict";var t=require("../../../../../../common/vendor.js"),e=require("../../../../../../api/erp/warehouse/warehouseApi.js");require("../../../../../../common/request.js");const s={data:()=>({materials:[],checkalldisable:!0,warehouseid:"",search:"",isall:!0,numbers:1,loading:!1,listData:[],status:"more",contentText:{contentdown:"上拉加载更多",contentrefresh:"加载中",contentnomore:"没有更多"},pageSize:10,pageCurrent:1,total:0,shelfid:"",checknums:0,checkallstatus:!1}),onLoad(t){},onPullDownRefresh(){this.reload=!0,this.last_id="",this.status="more",this.getList()},onReachBottom(){this.reload=!1,this.getList()},methods:{goMaterialInfoPage(e){t.index.navigateTo({url:"../../../material/material?materialid="+e})},refreshList(t,e,s){this.warehouseid=t,this.shelfid=e,this.listData=[],this.status="more",this.reload=!0,this.search=s||"",0!=this.checkallstatus&&(this.checkallstatus=!1),this.pageCurrent=1,this.getList()},skuFunc:t=>t&&t.length>20?t.substr(0,20)+"...":null==t||""==t||null==t?"--":t,nameFunc:t=>t&&t.length>15?t.substr(0,15)+"...":null==t||""==t||null==t?"--":t,checkall(e,s){1==this.checkalldisable?t.index.showToast({title:"请拉到底部才能全选！",icon:"none",duration:2e3}):("all"==e.detail.value[0]?this.checkallstatus=!0:this.checkallstatus=!1,this.listData&&(1==this.checkallstatus?(this.materials=[],this.listData.forEach((t=>{t.checkstatus=!0,this.materials.push(t.materialid)})),this.checknums=this.materials.length):(this.materials=[],this.listData.forEach((t=>{t.checkstatus=!1})),this.checknums=this.materials.length)))},checkboxChange:function(t){var e=t.detail.value;this.materials=e,this.checknums=this.materials.length,this.checknums!=this.listData.length?this.checkallstatus=!1:this.checkallstatus=!0;let s=this;this.listData.forEach((t=>{s.materials.includes(t.materialid)?0==t.checkstatus&&(t.checkstatus=!0):1==t.checkstatus&&(t.checkstatus=!1)}))},getList(){if(this.total=0,"nomore"!=this.status){"more"==this.status&&(this.status="loading");var s={search:this.search,shelfid:this.shelfid,warehouseid:this.warehouseid,allchildren:"false",pagesize:this.pageSize,currentpage:this.pageCurrent};e.warehouseApi.getShelfList(s).then((e=>{if(e){if(e.records){let t=e.records;if(t.length>0)return t.forEach((t=>{t.checkstatus=!1})),this.listData=this.reload?t:this.listData.concat(t),this.reload=!1,void(this.pageCurrent>=e.total/10?(this.status="nomore",this.reload=!1,this.checkalldisable=!1):(this.pageCurrent=this.pageCurrent+1,this.status="more"))}this.reload=!1,this.status="nomore",this.checkalldisable=!1}else t.index.showToast({title:res.msg,icon:"none",duration:2e3})}))}},inputNumber(t){},submit(){var s=this;if(s.materials.length>0){var a=[];s.listData.forEach((function(t,e){if(s.materials.includes(t.materialid)){var i={};i.materialid=t.materialid,i.quantity=t.amount,i.opt=1,i.shelfid=s.shelfid,a.push(i)}})),t.index.showModal({title:"提示",content:"请确认是否操作?",success:function(i){i.confirm?e.warehouseApi.invAdd(a).then((e=>{s.$emit("submit",a),t.index.showToast({title:"上架成功",icon:"none",duration:3e3})})):i.cancel}})}else t.index.showToast({title:"请至少选择一个产品",icon:"none",duration:2e3})}}};if(!Array){t.resolveComponent("uni-load-more")()}Math;var a=t._export_sfc(s,[["render",function(e,s,a,i,h,l){return{a:t.f(h.listData,((e,s,a)=>({a:e.materialid,b:e.checkstatus,c:t.o((t=>l.goMaterialInfoPage(e.materialid))),d:e.image,e:t.t(l.nameFunc(e.name)),f:t.t(l.skuFunc(e.sku)),g:t.t(e.quantity),h:e.amount,i:e.amount,j:t.o((t=>e.amount=t.detail.value)),k:s}))),b:t.o(((...t)=>l.checkboxChange&&l.checkboxChange(...t))),c:t.p({status:h.status,"icon-size":16,"content-text":h.contentText}),d:h.checkalldisable,e:h.checkallstatus,f:t.o(((...t)=>l.checkall&&l.checkall(...t))),g:t.t(h.checknums),h:t.o(((...t)=>l.submit&&l.submit(...t)))}}]]);wx.createComponent(a);
